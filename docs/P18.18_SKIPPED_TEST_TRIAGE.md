# P18.18 Skipped Test Triage & Legacy Suite Audit

> **Date:** 2025-12-01
> **Status:** Active
> **Related:** [PASS18_ASSESSMENT_REPORT_PASS3.md](PASS18_ASSESSMENT_REPORT_PASS3.md), [PASS18_REMEDIATION_PLAN.md](PASS18_REMEDIATION_PLAN.md)

## 1. Overview

This document provides an authoritative inventory of skipped and disabled tests within the RingRift codebase (specifically TS/Jest suites). The goal is to transition from a state of "unknown debt" to "managed backlog" by classifying each skipped suite as **REMOVE** (obsolete), **REWRITE** (needs refactoring), or **RE-ENABLE** (valid and close to passing).

## 2. Skipped/Disabled Test Inventory

### 2.1 Unit & Scenario Tests (`tests/**`)

| Path                                                         | Category            | Classification           | Rationale                                                                                                                            |
| :----------------------------------------------------------- | :------------------ | :----------------------- | :----------------------------------------------------------------------------------------------------------------------------------- |
| `tests/scenarios/RulesMatrix.Comprehensive.test.ts`          | Scenario            | **PARTIALLY RE-ENABLED** | Core rules verification. Top-level skip removed. 3 specific tests (M2, C2, V2) remain skipped pending fixes.                         |
| `tests/integration/FullGameFlow.test.ts`                     | Integration         | **KEEP SKIPPED**         | Heavy AI soak (4000 moves). Duplicates `scripts/run-orchestrator-soak.ts`. Keep as manual diagnostic.                                |
| `tests/unit/GameContext.reconnect.test.tsx`                  | Unit (Frontend)     | **REWRITE**              | Tests WebSocket reconnection. Skipped due to mocking issues with `socket.io-client`. High value for UX stability.                    |
| `tests/unit/envFlags.test.ts`                                | Unit (Config)       | **KEEP SKIPPED**         | Tests `NODE_ENV` behavior which is hard to test in Jest. Low value for rules correctness.                                            |
| `tests/unit/GameEngine.regionOrderChoiceIntegration.test.ts` | Unit (Orchestrator) | **REWRITE**              | Tests `RegionOrderChoice` emission. Skipped because interaction handler isn't called as expected. Critical for orchestrator rollout. |
| `tests/unit/Sandbox_vs_Backend.aiHeuristicCoverage.test.ts`  | Unit (Parity)       | **REWRITE**              | Checks if sandbox AI moves are legal in backend. Critical for "Sandbox Parity". Needs to be updated for current architecture.        |
| `tests/unit/GameEngine.territoryDisconnection.test.ts`       | Unit (Legacy)       | **REMOVED**              | Legacy 19x19 territory integration. Superseded by `RulesMatrix` and orchestrator adapter tests.                                      |
| `tests/unit/GameEngine.decisionPhases.MoveDriven.test.ts`    | Unit (Legacy)       | **REMOVED**              | Explicitly marked `[SUPERSEDED]`. Replaced by `Orchestrator.Backend.multiPhase.test.ts`.                                             |
| `tests/unit/TraceParity.seed14.firstDivergence.test.ts`      | Unit (Diagnostic)   | **KEEP SKIPPED**         | Diagnostic helper for specific seed. Not a regression test.                                                                          |
| `tests/unit/GameEngine.territoryDisconnection.hex.test.ts`   | Unit (Legacy)       | **REWRITE**              | Hex territory integration. Calls deprecated `processAutomaticConsequences`. Should be updated to use `makeMove`.                     |
| `tests/unit/GameEngine.victory.LPS.crossInteraction.test.ts` | Unit (Victory)      | **REWRITE**              | Tests Last-Player-Standing logic. Mocks internal methods that may have changed. High value for edge cases.                           |
| `tests/unit/OrchestratorSInvariant.regression.test.ts`       | Unit (Invariant)    | **RE-ENABLED**           | Captures known S-invariant regressions. Re-enabled and passing.                                                                      |
| `tests/unit/GameEngine.territory.scenarios.test.ts`          | Unit (Legacy)       | **REMOVED**              | "Diagnostic reference only". Likely covered by `RulesMatrix`.                                                                        |
| `tests/unit/GameEngine.cyclicCapture.hex.height3.test.ts`    | Unit (Diagnostic)   | **ARCHIVE**              | Hex cyclic capture diagnostics.                                                                                                      |
| `tests/unit/RuleEngine.movementCapture.test.ts`              | Unit (Legacy)       | **REMOVED**              | `RuleEngine` is now a facade. Movement validation is covered by `GameEngine` and `MovementAggregate` tests.                          |

### 2.2 Archived Tests (`archive/tests/**`)

| Path                                                                               | Category | Classification | Rationale                                   |
| :--------------------------------------------------------------------------------- | :------- | :------------- | :------------------------------------------ |
| `archive/tests/unit/Backend_vs_Sandbox.aiParallelDebug.test.ts`                    | Archived | **IGNORE**     | Already archived.                           |
| `archive/tests/unit/TerritoryParity.GameEngine_vs_Sandbox.test.ts`                 | Archived | **IGNORE**     | Already archived.                           |
| `archive/tests/unit/Backend_vs_Sandbox.traceParity.test.ts`                        | Archived | **IGNORE**     | Already archived.                           |
| `tests/unit/archive/territoryProcessing.rules.test.ts`                             | Archived | **IGNORE**     | Already archived (in `tests/unit/archive`). |
| `tests/unit/archive/WebSocketServer.aiTurn.integration.test.ts`                    | Archived | **IGNORE**     | Already archived.                           |
| `tests/unit/archive/GameEngine.captureDirectionChoiceWebSocketIntegration.test.ts` | Archived | **IGNORE**     | Already archived.                           |

## 3. High-Priority Subsets

The following suites are the most valuable to address immediately:

1.  **`tests/scenarios/RulesMatrix.Comprehensive.test.ts`**: This is the primary "rulebook verification" suite. Re-enabling this (even with some individual tests skipped) provides a baseline for correctness.
2.  **`tests/unit/OrchestratorSInvariant.regression.test.ts`**: Invariant regressions must be monitored.
3.  **`tests/unit/GameEngine.regionOrderChoiceIntegration.test.ts`**: Critical for the orchestrator's ability to handle complex turns via WebSocket.

## 4. Proposed Follow-up Tasks

### P18.18-1: Clean up Obsolete Suites (COMPLETED)

- **Action:** Deleted `tests/unit/GameEngine.decisionPhases.MoveDriven.test.ts`, `tests/unit/GameEngine.territoryDisconnection.test.ts`, `tests/unit/GameEngine.territory.scenarios.test.ts`, and `tests/unit/RuleEngine.movementCapture.test.ts`.
- **Rationale:** Explicitly superseded by newer orchestrator tests.

### P18.18-2: Re-enable Rules Matrix (COMPLETED)

- **Action:** Removed `describe.skip` from `tests/scenarios/RulesMatrix.Comprehensive.test.ts`.
- **Action:** Skipped individual failing tests (M2, C2, V2).
- **Status:** Suite passes with 7 tests passing and 3 skipped.

### P18.18-3: Re-enable S-Invariant Regression (COMPLETED)

- **Action:** Removed `.skip` from `tests/unit/OrchestratorSInvariant.regression.test.ts`.
- **Status:** Test passes, confirming the regression is fixed.

### P19.1: Rewrite Region Order Integration

- **Action:** Refactor `tests/unit/GameEngine.regionOrderChoiceIntegration.test.ts` to correctly mock the interaction handler and verify WebSocket emissions.

### P19.2: Rewrite LPS Cross-Interaction

- **Action:** Refactor `tests/unit/GameEngine.victory.LPS.crossInteraction.test.ts` to use public APIs instead of mocking internal `GameEngine` methods.

### P19.3: Fix RulesMatrix Failures

- **Action:** Investigate and fix the 3 skipped tests in `tests/scenarios/RulesMatrix.Comprehensive.test.ts`:
  - `M2: Rules_8_2_Q2_markers_any_valid_space_beyond_square8`
  - `C2: Rules_10_3_Q15_3_2_cyclic_pattern_triangle_loop`
  - `V2: Forced Elimination Ladder`
